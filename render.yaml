services:
  # ⚙️ Worker service (only backend, no frontend)
  - type: worker
    name: viralvibes-worker
    env: python
    plan: free                # use free plan first; upgrade to starter ($7) if killed often
    buildCommand: |
      pip install --upgrade pip
      pip install --no-cache-dir -r requirements-backend.txt
    startCommand: |
      # decode cookies into /tmp
      echo $YOUTUBE_COOKIES | base64 -d > /tmp/cookies.txt
      python -m worker.worker
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
      - key: YOUTUBE_COOKIES
        sync: false
      - key: WORKER_POLL_INTERVAL
        value: 10
      - key: WORKER_BATCH_SIZE
        value: 3
      - key: WORKER_MAX_RUNTIME
        value: 300
      - key: COOKIES_FILE
        value: /tmp/cookies.txt
