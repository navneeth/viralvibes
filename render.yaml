services:
  # ⚙️ Worker service (only backend, no frontend)
  - type: worker
    name: viralvibes-worker
    env: python
    runtime: python-3.10  # Be explicit about runtime version
    plan: free
    buildCommand: |
      pip install --upgrade pip
      pip install --no-cache-dir -r requirements-backend.txt
    startCommand: |
      # decode cookies into /tmp
      echo $YOUTUBE_COOKIES | base64 -d > /tmp/cookies.txt
      python -m worker.creator_worker
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
      - key: YOUTUBE_COOKIES
        sync: false
      - key: YOUTUBE_API_KEY
        sync: false
      - key: WORKER_POLL_INTERVAL
        value: "60"
      - key: WORKER_BATCH_SIZE
        value: "1"
      - key: WORKER_MAX_RUNTIME
        value: "300"
      - key: COOKIES_FILE
        value: /tmp/cookies.txt
      - key: MIN_VIDEO_DELAY
        value: "3.0"
      - key: MAX_VIDEO_DELAY
        value: "8.0"
      - key: MIN_REQUEST_DELAY
        value: "5.0"
      - key: MAX_REQUEST_DELAY
        value: "10.0"
      - key: BOT_CHALLENGE_BACKOFF
        value: "1800"
